{% extends 'core/base.html' %}
<!-- template -->
{% load form_tags %} {% block content %}
<style>
  /* Profile Container */
  .profile-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
    font-family: "Inter", sans-serif;
  }

  /* Profile Header */
  .profile-header {
    background: linear-gradient(
      135deg,
      var(--darker-bg) 0%,
      var(--card-bg) 100%
    );
    border-radius: 15px;
    padding: 3rem 2rem;
    text-align: center;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .profile-header h1 {
    color: var(--primary-color);
    font-size: 2.5rem;
    margin-bottom: 1rem;
    font-weight: 600;
  }

  .profile-header p {
    color: var(--text-secondary);
    font-size: 1.2rem;
    max-width: 600px;
    margin: 0 auto;
  }

  /* Profile Stats */
  .profile-stats {
    background: var(--card-bg);
    border-radius: 15px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .profile-stats h2 {
    color: var(--primary-color);
    font-size: 1.5rem;
    margin-bottom: 1rem;
    font-weight: 600;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
  }

  .stat-item {
    background: var(--darker-bg);
    padding: 1rem;
    border-radius: 10px;
    text-align: center;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100px;
  }

  .stat-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  }

  .stat-item h3 {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    font-weight: 500;
  }

  .stat-item p {
    color: var(--primary-color);
    font-size: 1.75rem;
    font-weight: 600;
    margin: 0;
    line-height: 1;
  }

  /* Navigation */
  .profile-nav {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    justify-content: center;
  }

  .profile-nav-item {
    background: var(--card-bg);
    border: none;
    padding: 0.8rem 1.5rem;
    border-radius: 25px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
  }

  .profile-nav-item:hover,
  .profile-nav-item.active {
    background: var(--primary-color);
    color: var(--text-primary);
    transform: translateY(-2px);
  }

  /* Sections */
  .profile-sections {
    background: var(--card-bg);
    border-radius: var(--border-radius-lg);
    padding: 1rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .section {
    display: none;
    animation: fadeIn 0.5s ease;
  }

  .section.active {
    display: block;
  }

  .section h2 {
    color: var(--primary-color);
    font-size: 1.8rem;
    margin-bottom: 1.5rem;
    font-weight: 600;
  }

  /* Section Header */
  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }

  .section-actions {
    display: flex;
    gap: 1rem;
    align-items: center;
  }

  .section-actions .retry-button {
    width: auto;
    min-width: 120px;
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }

  .action-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: 5px;
    background: var(--primary-color);
    color: var(--text-primary);
    text-decoration: none;
    font-size: 0.9rem;
    transition: all 0.3s ease;
  }

  .action-btn:hover {
    background: var(--primary-color-dark);
    transform: translateY(-2px);
  }

  .add-record-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 5px;
    background: var(--primary-color);
    color: var(--text-primary);
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.3s ease;
  }

  .add-record-btn:hover {
    background: var(--primary-color-dark);
    transform: translateY(-2px);
  }

  /* Record Items */
  .experience-item,
  .project-item,
  .education-item,
  .certification-item,
  .publication-item {
    background: var(--darker-bg);
    border-radius: 10px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    position: relative;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .experience-item:hover,
  .project-item:hover,
  .education-item:hover,
  .certification-item:hover,
  .publication-item:hover {
    transform: translateX(5px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .record-actions {
    position: absolute;
    top: 1rem;
    right: 1rem;
    display: flex;
    gap: 0.5rem;
  }

  .record-actions button {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.3rem;
    transition: color 0.3s ease;
    font-size: 1.1rem;
  }

  .record-actions button:hover {
    color: var(--primary-color);
  }

  .record-actions .delete-btn:hover {
    color: var(--danger-color, #dc3545);
  }

  /* Forms */
  .add-record-form {
    display: none;
    background: var(--darker-bg);
    padding: 1.5rem;
    border-radius: 10px;
    margin-bottom: 2rem;
  }

  .add-record-form.active {
    display: block;
  }

  .add-record-form input,
  .add-record-form textarea,
  .add-record-form select {
    width: 100%;
    padding: 0.8rem;
    margin-bottom: 1rem;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    background: var(--card-bg);
    color: var(--text-primary);
    font-size: 1rem;
  }

  .add-record-form input:focus,
  .add-record-form textarea:focus,
  .add-record-form select:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.25rem rgba(108, 99, 255, 0.25);
    outline: none;
  }

  .add-record-form label {
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
    display: block;
    font-weight: 500;
  }

  /* Buttons */
  .add-record-btn {
    background: var(--primary-color);
    color: var(--text-primary);
    border: none;
    padding: 0.8rem 1.5rem;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .add-record-btn:hover {
    background: var(--secondary-color);
    transform: translateY(-2px);
  }

  /* Import Section */
  .import-section {
    background: var(--card-bg);
    border-radius: var(--border-radius-lg);
    padding: var(--spacing-xl);
    margin-bottom: var(--spacing-xl);
    box-shadow: var(--shadow-md);
  }

  .import-section h2 {
    color: var(--primary-color);
    font-size: 1.8rem;
    margin-bottom: var(--spacing-xl);
    text-align: center;
  }

  .import-options {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--spacing-xl);
    margin-top: var(--spacing-lg);
  }

  .import-card {
    background: var(--darker-bg);
    border-radius: var(--border-radius-md);
    padding: var(--spacing-xl);
    text-align: center;
    transition: all var(--transition-speed) var(--transition-timing);
    border: 1px solid var(--border-color);
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
  }

  .import-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary-color);
  }

  .import-card i {
    font-size: 3rem;
    color: var(--primary-color);
    margin-bottom: var(--spacing-lg);
    transition: transform var(--transition-speed) var(--transition-timing);
  }

  .import-card:hover i {
    transform: scale(1.1);
  }

  .import-card h3 {
    color: var(--text-primary);
    margin-bottom: var(--spacing-sm);
    font-size: 1.4rem;
    font-weight: 600;
  }

  .import-card p {
    color: var(--text-secondary);
    margin-bottom: var(--spacing-lg);
    font-size: 1rem;
    line-height: 1.5;
  }

  .import-form {
    display: none;
    width: 100%;
    margin-top: var(--spacing-md);
  }

  .import-form.active {
    display: block;
  }

  .import-form input {
    width: 100%;
    padding: var(--spacing-sm) var(--spacing-md);
    margin-bottom: var(--spacing-sm);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius-sm);
    background: var(--card-bg);
    color: var(--text-primary);
  }

  .import-form input:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 2px rgba(108, 99, 255, 0.2);
  }

  .retry-button {
    background: var(--primary-color);
    color: var(--text-primary);
    border: none;
    padding: var(--spacing-sm) var(--spacing-lg);
    border-radius: var(--border-radius-md);
    cursor: pointer;
    transition: all var(--transition-speed) var(--transition-timing);
    font-weight: 500;
    width: 100%;
  }

  .retry-button:hover {
    background: var(--secondary-color);
    transform: translateY(-2px);
  }

  /* Style for inline action buttons (not full-width, primary-styled) */
  .inline-action-btn {
    background: var(--primary-color);
    color: var(--text-primary);
    border: none;
    padding: 0.5rem 1rem; /* Consistent with .section-actions .retry-button */
    border-radius: var(
      --border-radius-md,
      6px
    ); /* Fallback if --border-radius-md is not defined */
    cursor: pointer;
    transition: all var(--transition-speed, 0.3s) var(--transition-timing, ease); /* Fallbacks for transition vars */
    font-weight: 500; /* Consistent with retry-button */
    font-size: 0.9rem; /* Consistent with .section-actions .retry-button */
    width: auto; /* Not full-width */
    min-width: 120px; /* Consistent with .section-actions .retry-button */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    text-decoration: none; /* For <a> tags styled as buttons */
  }

  .inline-action-btn:hover {
    background: var(
      --secondary-color,
      var(--primary-color-dark)
    ); /* Fallback for hover color */
    transform: translateY(-2px);
    color: var(--text-primary); /* Ensure text color consistency on hover */
  }

  .bio-actions-center {
    text-align: center;
    margin-top: 0.75rem; /* Spacing between textarea and this action block */
  }

  .file-upload {
    border: 2px dashed var(--border-color);
    border-radius: var(--border-radius-md);
    padding: var(--spacing-lg);
    text-align: center;
    margin-bottom: var(--spacing-md);
    cursor: pointer;
    transition: all var(--transition-speed) var(--transition-timing);
  }

  .file-upload:hover {
    border-color: var(--primary-color);
    background: rgba(108, 99, 255, 0.1);
  }

  .file-upload input[type="file"] {
    display: none;
  }

  .file-upload label {
    color: var(--text-secondary);
    cursor: pointer;
  }

  @media (max-width: 992px) {
    .import-options {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 768px) {
    .import-options {
      grid-template-columns: 1fr;
    }

    .import-section {
      padding: var(--spacing-lg);
    }

    .import-card {
      padding: var(--spacing-lg);
    }

    .stats-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    .stat-item {
      min-height: 90px;
      padding: 0.75rem;
    }

    .stat-item h3 {
      font-size: 0.85rem;
    }

    .stat-item p {
      font-size: 1.5rem;
    }
  }

  /* Loading Overlay */
  .loading-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  .loading-spinner {
    width: 50px;
    height: 50px;
    border: 5px solid var(--primary-color);
    border-top: 5px solid transparent;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  /* Animations */
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .profile-container {
      padding: 0 0.5rem;
    }

    .profile-header {
      padding: 2rem 1rem;
    }

    .profile-header h1 {
      font-size: 2rem;
    }

    .profile-sections {
      padding: 1rem;
    }
  }

  /* Basic Information Section */
  #basic-info {
    width: 100%;
    padding: 0;
  }

  #basic-info h2 {
    color: var(--primary-color);
    font-size: 1.25rem;
    margin-bottom: 0.75rem;
  }

  #basic-info form {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.4rem;
    width: 100%;
    margin: 0;
  }

  #basic-info .name-title-row {
    grid-column: 1 / -1;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.4rem;
  }

  #basic-info .full-width {
    grid-column: 1 / -1;
  }

  #basic-info label {
    display: block;
    color: var(--text-secondary);
    font-size: 0.85rem;
    font-weight: 400;
    margin-bottom: 0.1rem;
  }

  #basic-info input,
  #basic-info textarea {
    width: 100%;
    padding: 0.25rem 0.4rem;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    background: var(--darker-bg);
    color: var(--text-primary);
    font-size: 0.9rem;
    line-height: 1.2;
    margin: 0;
  }

  #basic-info textarea {
    min-height: 60px;
    max-height: 120px;
    resize: vertical;
  }

  #basic-info button[type="submit"] {
    grid-column: 1 / -1;
    width: 100%;
    background: var(--primary-color);
    color: var(--text-primary);
    border: none;
    padding: 0.35rem;
    border-radius: 4px;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 0.4rem;
  }

  @media (max-width: 768px) {
    #basic-info form {
      grid-template-columns: 1fr;
      gap: 0.35rem;
    }

    #basic-info .name-title-row {
      grid-template-columns: 1fr;
      gap: 0.35rem;
    }
  }

  #skills .skills-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem; /* Spacing between skill cards */
    margin-top: 1.5rem;
  }

  #skills .skill-item {
    background: var(--darker-bg);
    border-radius: var(--border-radius-lg, 12px);
    padding: 1.5rem;
    box-shadow: var(--shadow-md, 0 4px 6px rgba(0, 0, 0, 0.1));
    position: relative;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    flex: 1 1 280px; /* Allows cards to grow and shrink, with a base width */
    min-width: 250px; /* Minimum width for each skill card */
    display: flex;
    flex-direction: column; /* Ensures content and actions stack vertically if needed */
  }

  #skills .skill-item:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg, 0 8px 15px rgba(0, 0, 0, 0.15));
  }

  #skills .skill-item-content {
    flex-grow: 1; /* Allows content to take up available space */
  }

  #skills .skill-item h3 {
    /* Skill name */
    color: var(--primary-color);
    font-size: 1.25rem;
    font-weight: 600;
    margin-top: 0; /* Remove default margin if any */
    margin-bottom: 0.75rem;
    line-height: 1.3;
  }

  #skills .skill-item-content p {
    /* General paragraphs within skill content */
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    line-height: 1.4;
  }

  #skills .skill-item-content p:last-child {
    margin-bottom: 0; /* Remove margin from the last paragraph in content */
  }

  #skills .skill-category-label {
    /* Specific styling for category if needed */
  }

  #skills .skill-proficiency-label {
    font-weight: 500; /* Make proficiency stand out a bit */
    color: var(--text-primary); /* Slightly more prominent color */
  }

  /* Record actions within skill items */
  #skills .skill-item .record-actions {
    position: absolute;
    top: 1rem;
    right: 1rem;
    display: flex;
    gap: 0.5rem;
    opacity: 0.6; /* Slightly transparent by default, more subtle */
    transition: opacity 0.3s ease;
  }

  #skills .skill-item:hover .record-actions {
    opacity: 1; /* Fully visible on hover */
  }

  #skills .skill-item .record-actions button {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.3rem;
    font-size: 1rem; /* Adjust icon size */
    transition: color 0.3s ease;
  }

  #skills .skill-item .record-actions button:hover {
    color: var(--primary-color);
  }

  #skills .skill-item .record-actions .delete-btn:hover {
    color: var(--danger-color, #dc3545); /* Fallback danger color */
  }

  /* Empty state message for skills */
  #skills .skills-grid .no-records-message {
    width: 100%; /* Take full width of the grid container */
    text-align: center;
    padding: 2rem;
    background-color: var(--darker-bg);
    border-radius: var(--border-radius-md, 8px);
    color: var(--text-secondary);
    font-style: italic;
    margin-top: 1rem; /* Add some space if it's the only item */
  }

  /* GitHub Section Styles */
  .github-content {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .github-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .github-stat-card {
    background: var(--darker-bg);
    padding: 1.5rem;
    border-radius: 10px;
    text-align: center;
    transition: transform 0.3s ease;
  }

  .github-stat-card:hover {
    transform: translateY(-5px);
  }

  .github-stat-card h3 {
    color: var(--text-secondary);
    font-size: 1rem;
    margin-bottom: 0.5rem;
  }

  .github-stat-card p {
    color: var(--primary-color);
    font-size: 2rem;
    font-weight: 600;
  }

  .github-repos-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-top: 1rem;
  }

  .github-repo-card {
    background: var(--darker-bg);
    border-radius: 10px;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    transition: transform 0.3s ease;
  }

  .github-repo-card:hover {
    transform: translateY(-5px);
  }

  .repo-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }

  .repo-header h4 {
    color: var(--primary-color);
    font-size: 1.2rem;
    margin: 0;
  }

  .repo-stats {
    display: flex;
    gap: 1rem;
    color: var(--text-secondary);
    font-size: 0.9rem;
  }

  .repo-description {
    color: var(--text-secondary);
    font-size: 0.9rem;
    line-height: 1.4;
    margin: 0;
  }

  .repo-meta {
    display: flex;
    gap: 1rem;
    color: var(--text-secondary);
    font-size: 0.8rem;
  }

  .repo-tech-stack {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .tech-tag {
    background: var(--primary-color);
    color: var(--text-primary);
    padding: 0.2rem 0.5rem;
    border-radius: 15px;
    font-size: 0.8rem;
  }

  .repo-link {
    color: var(--primary-color);
    text-decoration: none;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: auto;
  }

  .repo-link:hover {
    text-decoration: underline;
  }

  .github-languages-section {
    margin-top: 2rem;
  }

  .language-stats {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .language-bar {
    background: var(--darker-bg);
    padding: 1rem;
    border-radius: 10px;
  }

  .language-info {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
  }

  .language-name {
    color: var(--text-primary);
    font-weight: 500;
  }

  .language-percentage {
    color: var(--text-secondary);
  }

  .progress-bar {
    background: var(--card-bg);
    height: 6px;
    border-radius: 3px;
    overflow: hidden;
  }

  .progress {
    background: var(--primary-color);
    height: 100%;
    transition: width 0.3s ease;
  }

  .github-empty-state {
    text-align: center;
    padding: 3rem;
    background: var(--darker-bg);
    border-radius: 10px;
    margin-top: 1rem;
  }

  .github-empty-state i {
    font-size: 4rem;
    color: var(--text-secondary);
    margin-bottom: 1rem;
  }

  .github-empty-state h3 {
    color: var(--text-primary);
    margin-bottom: 0.5rem;
  }

  .github-empty-state p {
    color: var(--text-secondary);
    margin-bottom: 1.5rem;
  }

  .github-import-btn {
    background: var(--primary-color);
    color: var(--text-primary);
    border: none;
    padding: 0.8rem 1.5rem;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }

  .github-import-btn:hover {
    background: var(--primary-color-dark);
    transform: translateY(-2px);
  }

  @media (max-width: 768px) {
    .github-stats-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .github-repos-grid {
      grid-template-columns: 1fr;
    }
  }

  .github-skills-section {
    margin-top: 2rem;
  }

  .github-skills-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-top: 1rem;
  }

  .skill-tag {
    background: var(--darker-bg);
    padding: 0.75rem 1rem;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .skill-name {
    color: var(--primary-color);
    font-weight: 500;
  }

  .skill-category {
    color: var(--text-secondary);
    font-size: 0.8rem;
  }

  .github-profile-header {
    background: var(--darker-bg);
    border-radius: 10px;
    padding: 2rem;
    margin-bottom: 2rem;
  }

  .github-profile-info {
    display: flex;
    gap: 2rem;
    align-items: flex-start;
  }

  .github-avatar {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    object-fit: cover;
  }

  .github-profile-details {
    flex: 1;
  }

  .github-profile-details h3 {
    color: var(--primary-color);
    font-size: 1.8rem;
    margin-bottom: 0.5rem;
  }

  .github-bio {
    color: var(--text-secondary);
    font-size: 1.1rem;
    margin-bottom: 1rem;
    line-height: 1.5;
  }

  .github-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .github-meta span {
    color: var(--text-secondary);
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .github-meta a {
    color: var(--primary-color);
    text-decoration: none;
  }

  .github-meta a:hover {
    text-decoration: underline;
  }

  .github-profile-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: var(--primary-color);
    color: var(--text-primary);
    padding: 0.5rem 1rem;
    border-radius: 5px;
    text-decoration: none;
    font-size: 0.9rem;
    transition: all 0.3s ease;
  }

  .github-profile-link:hover {
    background: var(--primary-color-dark);
    transform: translateY(-2px);
  }

  @media (max-width: 768px) {
    .github-profile-info {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .github-meta {
      justify-content: center;
    }
  }

  /* Edit form styles */
  .edit-record-form {
    background-color: var(--bg-secondary);
    border-radius: 8px;
    padding: 20px;
    margin: 10px 0;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }

  .edit-record-form input,
  .edit-record-form textarea,
  .edit-record-form select {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    background-color: var(--bg-primary);
    color: var(--text-primary);
  }

  .edit-record-form label {
    display: block;
    margin-bottom: 5px;
    color: var(--text-secondary);
  }

  .edit-record-form .form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 15px;
  }

  .edit-record-form .save-btn {
    background-color: var(--primary-color);
    color: #fff;
    border: none;
    padding: 10px 15px;
    border-radius: 4px;
    cursor: pointer;
  }

  .edit-record-form .cancel-btn {
    background-color: var(--bg-primary);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    padding: 10px 15px;
    border-radius: 4px;
    cursor: pointer;
  }

  .edit-record-form .save-btn:hover {
    background-color: var(--primary-color-dark);
  }

  .edit-record-form .cancel-btn:hover {
    background-color: var(--bg-secondary);
  }

  /* Notification styles */
  .notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 20px;
    border-radius: 5px;
    color: white;
    font-weight: 500;
    z-index: 1000;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
    transform: translateY(-20px);
    opacity: 0;
    transition: transform 0.3s, opacity 0.3s;
  }

  .notification.show {
    transform: translateY(0);
    opacity: 1;
  }

  .notification.success {
    background-color: #4caf50;
  }

  .notification.error {
    background-color: #f44336;
  }

  .notification.warning {
    background-color: #ffc107;
    color: #333;
  }

  .notification.info {
    background-color: #2196f3;
  }
</style>

<div class="profile-container">
  <div class="profile-header">
    <h1>{{ user.get_full_name|default:user.username }}'s Profile</h1>
    <p>{{ user.userprofile.title|default:"Add your professional title" }}</p>
  </div>

  {% if parsed_resume_data %}
  <div class="parsed-resume-section">
    <h2>Parsed Resume Data</h2>
    <div class="parsed-data">
      <pre>{{ parsed_resume_data.raw_text }}</pre>
    </div>
    <div class="parsed-actions">
      <button onclick="prefillWorkExperiences()">Fill Work Experiences</button>
      <button onclick="prefillEducation()">Fill Education</button>
      <button onclick="prefillSkills()">Fill Skills</button>
      <button onclick="prefillProjects()">Fill Projects</button>
      <button onclick="prefillCertifications()">Fill Certifications</button>
    </div>
  </div>
  {% endif %}

  <!-- Import Section -->
  <div class="import-section">
    <h2>Import Profile Data</h2>
    <div class="import-options">
      <!-- GitHub Import -->
      <div class="import-card">
        <i class="fab fa-github"></i>
        <h3>Import from GitHub</h3>
        <p>Import your work experience and skills from your GitHub profile</p>
        <button onclick="showImportForm('github')" class="retry-button">
          Import from GitHub
        </button>
        <div id="github-form" class="import-form">
          <input
            type="text"
            id="github-username"
            placeholder="Enter your GitHub profile Username or URL"
          />
          <button onclick="importFromGitHub()" class="retry-button">
            Import
          </button>
        </div>
      </div>

      <!-- Resume Import -->
      <div class="import-card">
        <i class="fas fa-file-alt"></i>
        <h3>Import from Resume</h3>
        <p>Upload your resume to automatically fill your profile</p>
        <button onclick="showImportForm('resume')" class="retry-button">
          Upload Resume
        </button>
        <div id="resume-form" class="import-form">
          <div class="file-upload">
            <input type="file" id="resume-file" accept=".pdf,.doc,.docx" />
            <label for="resume-file">Choose a file or drag it here</label>
          </div>
          <button onclick="importFromResume()" class="retry-button">
            Import
          </button>
        </div>
      </div>

      <!-- LinkedIn Import -->
      <div class="import-card">
        <i class="fab fa-linkedin"></i>
        <h3>Import from LinkedIn</h3>
        <p>Import your professional information from LinkedIn (Coming Soon)</p>
        <button
          onclick="showImportForm('linkedin')"
          class="retry-button disabled"
          disabled
        >
          Import from LinkedIn
        </button>
        <div id="linkedin-form" class="import-form">
          <input
            type="url"
            id="linkedin-url"
            placeholder="Enter your LinkedIn profile URL"
          />
          <button onclick="importFromLinkedIn()" class="retry-button">
            Import
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="loading-spinner"></div>
  </div>

  <div class="profile-stats">
    <h2>Profile Statistics</h2>
    <div class="stats-grid">
      <div class="stat-item">
        <h3>Work Experience</h3>
        <p id="work-experience-count">
          {{ user.userprofile.work_experiences.count }}
        </p>
      </div>
      <div class="stat-item">
        <h3>Projects</h3>
        <p id="projects-count">{{ user.userprofile.projects.count }}</p>
      </div>
      <div class="stat-item">
        <h3>Skills</h3>
        <p id="skills-count">{{ user.userprofile.skills.count }}</p>
      </div>
      <div class="stat-item">
        <h3>Certifications</h3>
        <p id="certifications-count">
          {{ user.userprofile.certifications.count }}
        </p>
      </div>
      <div class="stat-item">
        <h3>Years of Experience</h3>
        <p id="years-of-experience">
          {{ user.userprofile.years_of_experience }}
        </p>
      </div>
    </div>
  </div>

  <div class="profile-nav">
    <button class="profile-nav-item active" onclick="showSection('basic-info')">
      Basic Info
    </button>
    <button class="profile-nav-item" onclick="showSection('experience')">
      Experience
    </button>
    <button class="profile-nav-item" onclick="showSection('projects')">
      Projects
    </button>
    <button class="profile-nav-item" onclick="showSection('education')">
      Education
    </button>
    <button class="profile-nav-item" onclick="showSection('certifications')">
      Certifications
    </button>
    <button class="profile-nav-item" onclick="showSection('publications')">
      Publications
    </button>
    <button class="profile-nav-item" onclick="showSection('skills')">
      Skills
    </button>
    <button class="profile-nav-item" onclick="showSection('github')">
      <i class="fab fa-github"></i> GitHub
    </button>
  </div>

  <div class="profile-sections">
    <!-- Basic Information Section -->
    <section id="basic-info" class="section active">
      <h2>Basic Information</h2>
      <form
        id="profile-basic-form"
        method="post"
        enctype="multipart/form-data"
        onsubmit="event.preventDefault(); saveProfileChanges();"
      >
        {% csrf_token %}
        <div class="name-title-row">
          <div>
            <label for="id_name">Name</label>
            {{ form.name }}
          </div>
          <div>
            <label for="id_title">Professional Title</label>
            {{ form.title }}
          </div>
        </div>
        <div>
          <label for="id_phone">Phone</label>
          {{ form.phone }}
        </div>
        <div>
          <label for="id_email">Email</label>
          {{ form.email }}
        </div>
        <div>
          <label for="id_github_url">GitHub URL</label>
          {{ form.github_url }}
        </div>
        <div>
          <label for="id_linkedin_url">LinkedIn URL</label>
          {{ form.linkedin_url }}
        </div>
        <div class="full-width">
          <label for="id_location">Location</label>
          {{ form.address }}
        </div>
        <div class="full-width">
          <label for="id_professional_summary">Professional Summary</label>
          {{ form.professional_summary }}
          <div class="bio-actions-center">
            <button
              type="button"
              id="generate-bio-btn"
              class="inline-action-btn"
            >
              <i class="fas fa-magic"></i> Generate Bio with AI
            </button>
            <small
              id="bio-status"
              class="form-text text-muted"
              style="display: block; margin-top: 0.25rem"
            ></small>
          </div>
        </div>
        <button type="submit" class="save-btn" style="margin-top: 0.75rem">
          Save Changes
        </button>
      </form>
    </section>

    <!-- Work Experience Section -->
    <section id="experience" class="section">
      <div class="section-header">
        <h2>Work Experience</h2>
        <button class="add-record-btn" onclick="toggleForm('experience-form')">
          <i class="fas fa-plus"></i> Add Experience
        </button>
      </div>
      <form
        id="experience-form"
        class="add-record-form"
        method="post"
        action="{% url 'core:add_work_experience' %}"
        onsubmit="return validateWorkExperienceForm(this)"
      >
        {% csrf_token %} {{ work_experience_form.as_p }}
        <button type="submit" class="retry-button">Add Experience</button>
      </form>

      {% for experience in work_experiences %}
      <div class="experience-item" data-record-id="{{ experience.id }}">
        <div class="record-actions">
          <button
            onclick="editRecord('work_experience', {{ experience.id }})"
            title="Edit"
          >
            <i class="fas fa-edit"></i>
          </button>
          <button
            onclick="deleteRecord('work_experience', {{ experience.id }})"
            class="delete-btn"
            title="Delete"
          >
            <i class="fas fa-trash"></i>
          </button>
        </div>
        <h3>{{ experience.position }} at {{ experience.company }}</h3>
        <div class="date-range">
          {{ experience.start_date|date:"M Y" }} - {% if experience.current %}
          Present {% else %} {{ experience.end_date }}
          <!-- Debug -->
          {% endif %}
          <!-- Debug info: End Date: {{ experience.end_date }}, Current: {{ experience.current }} -->
        </div>
        <p class="description">{{ experience.description }}</p>
        {% if experience.achievements %}
        <div class="achievements">{{ experience.achievements }}</div>
        {% endif %} 
        <!---->
        {% if experience.technologies %}
        <div class="technologies">{{ experience.technologies }}</div>
        {% endif %}
      </div>
      {% empty %}
      <p>No work experience added yet.</p>
      {% endfor %}
    </section>

    <!-- Projects Section -->
    <section id="projects" class="section">
      <div class="section-header">
        <h2>Projects</h2>
        <button class="add-record-btn" onclick="toggleForm('project-form')">
          <i class="fas fa-plus"></i> Add Project
        </button>
      </div>
      <form
        id="project-form"
        class="add-record-form"
        method="post"
        action="{% url 'core:add_project' %}"
      >
        {% csrf_token %} {{ project_form.as_p }}
        <button type="submit" class="retry-button">Add Project</button>
      </form>

      {% for project in projects %}
      <div class="project-item" data-record-id="{{ project.id }}">
        <div class="record-actions">
          <button
            onclick="editRecord('project', {{ project.id }})"
            title="Edit"
          >
            <i class="fas fa-edit"></i>
          </button>
          <button
            onclick="deleteRecord('project', {{ project.id }})"
            class="delete-btn"
            title="Delete"
          >
            <i class="fas fa-trash"></i>
          </button>
        </div>
        <h3>{{ project.title }}</h3>
        <p class="description">{{ project.description }}</p>
        {% if project.technologies %}
        <!-- Use repo-tech-stack for consistent styling with GitHub section -->
        <div class="technologies repo-tech-stack"> 
            {% for tech_item in project.technologies|split:"," %}
            <span class="tech-tag">{{ tech_item }}</span>
            {% endfor %}
        </div>        {% endif %}
        <div class="project-links">
          {% if project.github_url %}
          <a href="{{ project.github_url }}" target="_blank">GitHub</a>
          {% endif %} {% if project.live_url %}
          <a href="{{ project.live_url }}" target="_blank">Live Demo</a>
          {% endif %}
        </div>
      </div>
      {% empty %}
      <p>No projects added yet.</p>
      {% endfor %}
    </section>

    <!-- Education Section -->
    <section id="education" class="section">
      <div class="section-header">
        <h2>Education</h2>
        <button class="add-record-btn" onclick="toggleForm('education-form')">
          <i class="fas fa-plus"></i> Add Education
        </button>
      </div>
      <form
        id="education-form"
        class="add-record-form"
        method="post"
        action="{% url 'core:add_education' %}"
      >
        {% csrf_token %} {{ education_form.as_p }}
        <button type="submit" class="retry-button">Add Education</button>
      </form>

      {% for edu in education %}
      <div class="education-item" data-record-id="{{ edu.id }}">
        <div class="record-actions">
          <button onclick="editRecord('education', {{ edu.id }})" title="Edit">
            <i class="fas fa-edit"></i>
          </button>
          <button
            onclick="deleteRecord('education', {{ edu.id }})"
            class="delete-btn"
            title="Delete"
          >
            <i class="fas fa-trash"></i>
          </button>
        </div>
        <div class="degree">{{ edu.degree }}</div>
        <div class="location">{{ edu.institution }}</div>
        <div class="date-range">
          {{ edu.start_date|date:"M Y" }} - {{ edu.end_date|date:"M Y" }}
        </div>
        <p class="description">{{ edu.field_of_study }}</p>
        {% if edu.gpa %}
        <div class="gpa">GPA: {{ edu.gpa }}</div>
        {% endif %} {% if edu.achievements %}
        <div class="achievements">{{ edu.achievements }}</div>
        {% endif %}
      </div>
      {% empty %}
      <p>No education added yet.</p>
      {% endfor %}
    </section>

    <!-- Certifications Section -->
    <section id="certifications" class="section">
      <div class="section-header">
        <h2>Certifications</h2>
        <button
          class="add-record-btn"
          onclick="toggleForm('certification-form')"
        >
          <i class="fas fa-plus"></i> Add Certification
        </button>
      </div>
      <form
        id="certification-form"
        class="add-record-form"
        method="post"
        action="{% url 'core:add_certification' %}"
      >
        {% csrf_token %} {{ certification_form.as_p }}
        <button type="submit" class="retry-button">Add Certification</button>
      </form>

      {% for cert in certifications %}
      <div class="certification-item" data-record-id="{{ cert.id }}">
        <div class="record-actions">
          <button
            onclick="editRecord('certification', {{ cert.id }})"
            title="Edit"
          >
            <i class="fas fa-edit"></i>
          </button>
          <button
            onclick="deleteRecord('certification', {{ cert.id }})"
            class="delete-btn"
            title="Delete"
          >
            <i class="fas fa-trash"></i>
          </button>
        </div>
        <h3>{{ cert.name }}</h3>
        <div class="location">{{ cert.issuer }}</div>
        <div class="date-range">Issued: {{ cert.issue_date|date:"M Y" }}</div>
        {% if cert.expiry_date %}
        <div class="date-range">Expires: {{ cert.expiry_date|date:"M Y" }}</div>
        {% endif %} {% if cert.credential_id %}
        <p class="description">Credential ID: {{ cert.credential_id }}</p>
        {% endif %} {% if cert.credential_url %}
        <a href="{{ cert.credential_url }}" target="_blank">View Credential</a>
        {% endif %}
      </div>
      {% empty %}
      <p>No certifications added yet.</p>
      {% endfor %}
    </section>

    <!-- Publications Section -->
    <section id="publications" class="section">
      <div class="section-header">
        <h2>Publications</h2>
        <button class="add-record-btn" onclick="toggleForm('publication-form')">
          <i class="fas fa-plus"></i> Add Publication
        </button>
      </div>
      <form
        id="publication-form"
        class="add-record-form"
        method="post"
        action="{% url 'core:add_publication' %}"
      >
        {% csrf_token %} {{ publication_form.as_p }}
        <button type="submit" class="retry-button">Add Publication</button>
      </form>

      {% for pub in publications %}
      <div class="publication-item" data-record-id="{{ pub.id }}">
        <div class="record-actions">
          <button
            onclick="editRecord('publication', {{ pub.id }})"
            title="Edit"
          >
            <i class="fas fa-edit"></i>
          </button>
          <button
            onclick="deleteRecord('publication', {{ pub.id }})"
            class="delete-btn"
            title="Delete"
          >
            <i class="fas fa-trash"></i>
          </button>
        </div>
        <h3>{{ pub.title }}</h3>
        {% if pub.authors %}
        <p class="description">{{ pub.authors }}</p>
        {% endif %}
        <div class="date-range">{{ pub.publication_date|date:"M Y" }}</div>
        {% if pub.publisher %}
        <p class="description">Publisher: {{ pub.publisher }}</p>
        {% endif %} {% if pub.journal %}
        <p class="description">Journal: {{ pub.journal }}</p>
        {% endif %} {% if pub.doi %}
        <p class="description">DOI: {{ pub.doi }}</p>
        {% endif %} {% if pub.abstract %}
        <div class="abstract">{{ pub.abstract }}</div>
        {% endif %} {% if pub.url %}
        <a href="{{ pub.url }}" target="_blank">View Publication</a>
        {% endif %}
      </div>
      {% empty %}
      <p>No publications added yet.</p>
      {% endfor %}
    </section>

    <!-- Skills Section -->
    <section id="skills" class="section">
      <div class="section-header">
        <h2>Skills</h2>
        <div class="section-actions">
          <button
            onclick="window.location.href='{% url 'core:deduplicate_skills' %}'"
            class="retry-button"
            type="button"
          >
            <i class="fas fa-magic"></i> Clean Up Skills
          </button>
          <button class="retry-button" onclick="toggleForm('skill-form')">
            <i class="fas fa-plus"></i> Add Skill
          </button>
        </div>
      </div>
      <form
        id="skill-form"
        class="add-record-form"
        method="post"
        action="{% url 'core:add_skill' %}"
      >
        {% csrf_token %} {{ skill_form.as_p }}
        <button type="submit" class="retry-button">Add Skill</button>
      </form>

      <div class="skills-grid">
        {% for skill in skills %}
        <div class="skill-item" data-record-id="{{ skill.id }}">
          <div class="skill-item-content">
            <h3>{{ skill.name }}</h3>
            <p class="skill-category-label">Category: {{ skill.category }}</p>
            <p class="skill-proficiency-label">
              Proficiency: {{ skill.get_proficiency_display}}
            </p>
          </div>
          <div class="record-actions">
            <button onclick="editRecord('skill', {{ skill.id }})" title="Edit">
              <i class="fas fa-edit"></i>
            </button>
            <button
              onclick="deleteRecord('skill', {{ skill.id }})"
              class="delete-btn"
              title="Delete"
            >
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
        {% empty %}
        <p class="no-records-message">
          No skills added yet. Add your skills using the form above!
        </p>
        {% endfor %}
      </div>
    </section>

    <!-- GitHub Section -->
    <section id="github" class="section">
      <div class="section-header">
        <h2><i class="fab fa-github"></i> GitHub Profile</h2>
      </div>

      {% if github_data %}
      <div class="github-content">
        <!-- GitHub Profile Header -->
        <div class="github-profile-header">
          <div class="github-profile-info">
            {% if github_data.avatar_url %}
            <img
              src="{{ github_data.avatar_url }}"
              alt="GitHub Avatar"
              class="github-avatar"
            />
            {% endif %}
            <div class="github-profile-details">
              <h3>{{ github_data.username }}</h3>
              {% if github_data.bio %}
              <p class="github-bio">{{ github_data.bio }}</p>
              {% endif %}
              <div class="github-meta">
                {% if github_data.location %}
                <span
                  ><i class="fas fa-map-marker-alt"></i>
                  <!--{{ github_data.location }}-->
                  {{ github_data.location }}</span
                >
                {% endif %} {% if github_data.company %}
                <span
                  ><i class="fas fa-building"></i> {{ github_data.company
                  }}</span
                >
                {% endif %} {% if github_data.blog %}
                <span
                  ><i class="fas fa-globe"></i>
                  <a href="{{ github_data.blog }}" target="_blank"
                    >Website</a
                  ></span
                >
                {% endif %} {% if github_data.twitter_username %}
                <span
                  ><i class="fab fa-twitter"></i>
                  <a
                    href="https://twitter.com/{{ github_data.twitter_username }}"
                    target="_blank"
                    >@{{ github_data.twitter_username }}</a
                  ></span
                >
                {% endif %}
              </div>
              <a
                href="{{ github_data.profile_url }}"
                target="_blank"
                class="github-profile-link"
              >
                <i class="fab fa-github"></i> View GitHub Profile
              </a>
            </div>
          </div>
        </div>

        <!-- GitHub Stats -->
        <div class="github-stats-grid">
          <div class="github-stat-card">
            <h3>Repositories</h3>
            <p>{{ github_data.public_repos|default:"0" }}</p>
          </div>
          <div class="github-stat-card">
            <h3>Gists</h3>
            <p>{{ github_data.public_gists|default:"0" }}</p>
          </div>
          <div class="github-stat-card">
            <h3>Followers</h3>
            <p>{{ github_data.followers|default:"0" }}</p>
          </div>
          <div class="github-stat-card">
            <h3>Following</h3>
            <p>{{ github_data.following|default:"0" }}</p>
          </div>
          <div class="github-stat-card">
            <h3>Total Commits</h3>
            <p>{{ github_data.total_commits|default:"0" }}</p>
          </div>
          <div class="github-stat-card">
            <h3>Total Stars</h3>
            <p>{{ github_data.total_stars|default:"0" }}</p>
          </div>
        </div>

        <!-- Repositories Section -->
        {% if github_data.repositories %}
        <div class="github-repos-section">
          <h3>Top Repositories</h3>
          <div class="github-repos-grid">
            {% for repo in github_data.repositories %}
            <div class="github-repo-card">
              <div class="repo-header">
                <h4>{{ repo.name }}</h4>
                <div class="repo-stats">
                  <span><i class="fas fa-star"></i> {{ repo.stars }}</span>
                  <span
                    ><i class="fas fa-code-branch"></i> {{ repo.forks }}</span
                  >
                </div>
              </div>
              <p class="repo-description">
                {{ repo.description|default:"No description available" }}
              </p>
              <div class="repo-meta">
                <span
                  ><i class="fas fa-calendar"></i> Updated
                  <!---{{ repo.updated_at|date:"M d, Y" }}-->
                  {{ repo.updated_at|date:"M d, Y"}}</span
                >
                {% if repo.language %}
                <span><i class="fas fa-code"></i> {{ repo.language }}</span>
                {% endif %}
              </div>
              <div class="repo-tech-stack">
                {% for tech in repo.technologies %}
                <span class="tech-tag">{{ tech }}</span>
                {% endfor %}
              </div>
              <a href="{{ repo.html_url }}" target="_blank" class="repo-link">
                <i class="fab fa-github"></i> View Repository
              </a>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Work Experience from GitHub -->
        {% if github_data.work_experiences %}
        <div class="github-repos-section">
          <h3>Work Experience</h3>
          <div class="github-repos-grid">
            {% for exp in github_data.work_experiences %}
            <div class="github-repo-card">
              <div class="repo-header">
                <h4>{{ exp.position }} at {{ exp.company }}</h4>
              </div>
              <p class="repo-description">{{ exp.description }}</p>
              <div class="repo-meta">
                <span
                  ><i class="fas fa-calendar"></i> {{ exp.start_date }} - {{
                  exp.end_date|default:"Present" }}</span
                >
              </div>
              <div class="repo-tech-stack">
                {% for tech in exp.technologies %}
                <span class="tech-tag">{{ tech }}</span>
                {% endfor %}
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Languages and Technologies -->
        {% if github_data.languages %}
        <div class="github-languages-section">
          <h3>Languages & Technologies</h3>
          <div class="language-stats">
            {% for language, stats in github_data.languages.items %}
            <div class="language-bar">
              <div class="language-info">
                <span class="language-name">{{ language }}</span>
                <span class="language-percentage"
                  >{{ stats.percentage|floatformat:1 }}%</span
                >
              </div>
              <div class="progress-bar">
                <div
                  class="progress"
                  style="width: {{ stats.percentage }}%"
                ></div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Skills from GitHub -->
        {% if github_data.skills %}
        <div class="github-skills-section">
          <h3>Skills</h3>
          <div class="github-skills-grid">
            {% for skill in github_data.skills %}
            <div class="skill-tag">
              <span class="skill-name">{{ skill.name }}</span>
              <span class="skill-category">{{ skill.category }}</span>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}
      </div>
      {% else %}
      <div class="github-empty-state">
        <i class="fab fa-github"></i>
        <h3>No GitHub Data Available</h3>
        <p>
          Use the Import from GitHub option in the Import Profile Data section
          to display your GitHub information here.
        </p>
      </div>
      {% endif %}
    </section>
  </div>
</div>

<script>
    function showSection(sectionId) {
        // Hide all sections
        document.querySelectorAll('.section').forEach(section => {
            section.classList.remove('active');
        });

        // Show selected section
        document.getElementById(sectionId).classList.add('active');

        // Update navigation
        document.querySelectorAll('.profile-nav-item').forEach(item => {
            item.classList.remove('active');
        });
        event.target.classList.add('active');
    }

    function showImportForm(type) {
        // Hide all forms
        document.querySelectorAll('.import-form').forEach(form => {
            form.classList.remove('active');
        });

        // Show selected form
        document.getElementById(`${type}-form`).classList.add('active');
    }

    function showLoading() {
        document.getElementById('loading-overlay').style.display = 'flex';
    }

    function hideLoading() {
        document.getElementById('loading-overlay').style.display = 'none';
    }

    async function importFromGitHub() {
        const githubUrl = document.getElementById('github-username').value;
        if (!githubUrl) {
            alert('Please enter your GitHub profile URL');
            return;
        }

        // Extract username from GitHub URL
        let username;
        try {
            const url = new URL(githubUrl);
            const pathParts = url.pathname.split('/').filter(part => part);
            username = pathParts[0]; // Get the first part of the path which should be the username
        } catch (e) {
            // If URL parsing fails, assume the input is a username
            username = githubUrl;
        }

        if (!username) {
            alert('Could not extract GitHub username from the URL');
            return;
        }

        showLoading();
        try {
            const response = await fetch('{% url "core:import_github_profile" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ github_url: username })
            });

            const data = await response.json();
            if (data.success) {
                location.reload();
            } else {
                alert('Error: ' + data.error);
            }
        } catch (error) {
            alert('Error importing profile: ' + error.message);
        } finally {
            hideLoading();
        }
    }

    async function importFromResume() {
        const fileInput = document.getElementById('resume-file');
        const file = fileInput.files[0];
        if (!file) {
            alert('Please select a resume file');
            return;
        }

        showLoading();
        const formData = new FormData();
        formData.append('resume', file);

        try {
            const response = await fetch('{% url "core:import_resume" %}', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: formData
            });

            const data = await response.json();
            if (data.success) {
                alert('Profile imported successfully!');
                location.reload();
            } else {
                alert('Error: ' + data.error);
            }
        } catch (error) {
            alert('Error importing profile: ' + error.message);
        } finally {
            hideLoading();
        }
    }

    async function importFromLinkedIn() {
        const url = document.getElementById('linkedin-url').value;
        if (!url) {
            alert('Please enter your LinkedIn profile URL');
            return;
        }

        showLoading();
        try {
            const response = await fetch('{% url "core:import_linkedin_profile" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ linkedin_url: url })
            });

            const data = await response.json();
            if (data.success) {
                alert('Profile imported successfully!');
                location.reload();
            } else {
                alert('Error: ' + data.error);
            }
        } catch (error) {
            alert('Error importing profile: ' + error.message);
        } finally {
            hideLoading();
        }
    }

    // Helper function to get CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function prefillWorkExperiences() {
        const workExperiences = {{ parsed_resume_data.work_experiences|default:'[]'|safe }};
        workExperiences.forEach(exp => {
            const form = document.querySelector('#work-experience-form');
            if (form) {
                form.querySelector('[name="company"]').value = exp.company || '';
                form.querySelector('[name="position"]').value = exp.position || '';
                form.querySelector('[name="start_date"]').value = exp.start_date || '';
                form.querySelector('[name="end_date"]').value = exp.end_date || '';
                form.querySelector('[name="description"]').value = exp.description || '';
                form.querySelector('[name="technologies"]').value = exp.technologies?.join(', ') || '';
                form.submit();
            }
        });
    }

    function prefillEducation() {
        const education = {{ parsed_resume_data.education|default:'[]'|safe }};
        education.forEach(edu => {
            const form = document.querySelector('#education-form');
            if (form) {
                form.querySelector('[name="institution"]').value = edu.institution || '';
                form.querySelector('[name="degree"]').value = edu.degree || '';
                form.querySelector('[name="field_of_study"]').value = edu.field_of_study || '';
                form.querySelector('[name="start_date"]').value = edu.start_date || '';
                form.querySelector('[name="end_date"]').value = edu.end_date || '';
                form.querySelector('[name="gpa"]').value = edu.gpa || '';
                form.querySelector('[name="achievements"]').value = edu.achievements?.join(', ') || '';
                form.submit();
            }
        });
    }

    function prefillSkills() {
        const skills = {{ parsed_resume_data.skills|default:'[]'|safe }};
        skills.forEach(skill => {
            const form = document.querySelector('#skill-form');
            if (form) {
                form.querySelector('[name="name"]').value = skill.name || '';
                form.querySelector('[name="category"]').value = skill.category || '';
                form.querySelector('[name="proficiency"]').value = skill.proficiency || '';
                form.submit();
            }
        });
    }

    function prefillProjects() {
        const projects = {{ parsed_resume_data.projects|default:'[]'|safe }};
        projects.forEach(proj => {
            const form = document.querySelector('#project-form');
            if (form) {
                form.querySelector('[name="title"]').value = proj.title || '';
                form.querySelector('[name="description"]').value = proj.description || '';
                form.querySelector('[name="start_date"]').value = proj.start_date || '';
                form.querySelector('[name="end_date"]').value = proj.end_date || '';
                form.querySelector('[name="technologies"]').value = proj.technologies?.join(', ') || '';
                form.submit();
            }
        });
    }

    function prefillCertifications() {
        const certifications = {{ parsed_resume_data.certifications|default:'[]'|safe }};
        certifications.forEach(cert => {
            const form = document.querySelector('#certification-form');
            if (form) {
                form.querySelector('[name="name"]').value = cert.name || '';
                form.querySelector('[name="issuer"]').value = cert.issuer || '';
                form.querySelector('[name="issue_date"]').value = cert.issue_date || '';
                form.querySelector('[name="expiry_date"]').value = cert.expiry_date || '';
                form.querySelector('[name="credential_id"]').value = cert.credential_id || '';
                form.submit();
            }
        });
    }

    async function deleteRecord(recordType, recordId) {
        try {
            const response = await fetch(`/profile/delete/${recordType}/${recordId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                }
            });

            if (response.ok) {
                const element = document.querySelector(`[data-record-id="${recordId}"]`);
                if (element) element.remove();
                showNotification('success', 'Record deleted successfully');
            } else {
                showNotification('error', 'Failed to delete record');
            }
        } catch (error) {
            showNotification('error', 'An error occurred while deleting the record');
        }
    }

    function editRecord(recordType, recordId) {
        const recordElement = document.querySelector(`[data-record-id="${recordId}"]`);
        const recordContent = recordElement.innerHTML;

        // Create edit form
        const editForm = document.createElement('form');
        editForm.className = 'edit-record-form';
        editForm.id = `edit-${recordType}-${recordId}-form`;
        editForm.setAttribute('onsubmit', 'event.preventDefault();');

        // Create form fields based on record type
        let formHTML = '';

        // Add CSRF token
        formHTML += `<input type="hidden" name="csrfmiddlewaretoken" value="${getCookie('csrftoken')}">`;

        if (recordType === 'work_experience') {
            formHTML += `
                <input type="text" name="company" placeholder="Company" value="${getTextContent(recordElement, '.location')}">
                <input type="text" name="position" placeholder="Position" value="${getTextContent(recordElement, 'h3')}">
                <input type="date" name="start_date" value="${extractDate(recordElement, 'start')}">
                <input type="date" name="end_date" value="${extractDate(recordElement, 'end')}">
                <label><input type="checkbox" name="current" ${isCurrentPosition(recordElement) ? 'checked' : ''}> Current Position</label>
                <textarea name="description" placeholder="Description">${getTextContent(recordElement, '.description')}</textarea>
                <textarea name="technologies" placeholder="Technologies (comma separated)">${getTextContent(recordElement, '.technologies')}</textarea>
            `;
        } else if (recordType === 'project') {
            formHTML += `
                <input type="text" name="title" placeholder="Title" value="${getTextContent(recordElement, 'h3')}">
                <textarea name="description" placeholder="Description">${getTextContent(recordElement, '.description')}</textarea>
                <textarea name="technologies" placeholder="Technologies (comma separated)">${getTextContent(recordElement, '.technologies')}</textarea>
                <input type="text" name="github_url" placeholder="GitHub URL" value="${getLinkHref(recordElement, 'GitHub')}">
                <input type="text" name="live_url" placeholder="Live URL" value="${getLinkHref(recordElement, 'Live Demo')}">
            `;
        } else if (recordType === 'education') {
            formHTML += `
                <input type="text" name="institution" placeholder="Institution" value="${getTextContent(recordElement, '.institution')}">
                <input type="text" name="degree" placeholder="Degree" value="${getTextContent(recordElement, '.degree')}">
                <input type="text" name="field_of_study" placeholder="Field of Study" value="${getTextContent(recordElement, '.field-of-study')}">
                <input type="date" name="start_date" value="${extractDate(recordElement, 'start')}">
                <input type="date" name="end_date" value="${extractDate(recordElement, 'end')}">
                <label><input type="checkbox" name="current" ${isCurrentPosition(recordElement) ? 'checked' : ''}> Current Education</label>
                <input type="number" name="gpa" step="0.01" min="0" max="4.0" placeholder="GPA" value="${getTextContent(recordElement, '.gpa')}">
                <textarea name="achievements" placeholder="Achievements">${getTextContent(recordElement, '.achievements')}</textarea>
            `;
        } else if (recordType === 'certification') {
            formHTML += `
                <input type="text" name="name" placeholder="Name" value="${getTextContent(recordElement, 'h3')}">
                <input type="text" name="issuer" placeholder="Issuer" value="${getTextContent(recordElement, '.issuer')}">
                <input type="date" name="issue_date" value="${extractDate(recordElement, 'issue')}">
                <input type="date" name="expiry_date" value="${extractDate(recordElement, 'expiry')}">
                <input type="text" name="credential_id" placeholder="Credential ID" value="${getTextContent(recordElement, '.credential-id')}">
                <input type="text" name="credential_url" placeholder="Credential URL" value="${getTextContent(recordElement, '.credential-url')}">
            `;
        } else if (recordType === 'publication') {
            formHTML += `
                <input type="text" name="title" placeholder="Title" value="${getTextContent(recordElement, 'h3')}">
                <input type="text" name="authors" placeholder="Authors" value="${getTextContent(recordElement, '.authors')}">
                <input type="date" name="publication_date" value="${extractDate(recordElement, 'publication')}">
                <input type="text" name="publisher" placeholder="Publisher" value="${getTextContent(recordElement, '.publisher')}">
                <input type="text" name="journal" placeholder="Journal" value="${getTextContent(recordElement, '.journal')}">
                <input type="text" name="doi" placeholder="DOI" value="${getTextContent(recordElement, '.doi')}">
                <textarea name="abstract" placeholder="Abstract">${getTextContent(recordElement, '.abstract')}</textarea>
                <input type="text" name="url" placeholder="URL" value="${getLinkHref(recordElement, 'View Publication')}">
            `;
        } else if (recordType === 'skill') {
            formHTML += `
                <input type="text" name="name" placeholder="Name" value="${getTextContent(recordElement, '.skill-name')}">
                <select name="category">
                    <option value="programming" ${getCategoryValue(recordElement) === 'programming' ? 'selected' : ''}>Programming</option>
                    <option value="framework" ${getCategoryValue(recordElement) === 'framework' ? 'selected' : ''}>Framework</option>
                    <option value="database" ${getCategoryValue(recordElement) === 'database' ? 'selected' : ''}>Database</option>
                    <option value="tool" ${getCategoryValue(recordElement) === 'tool' ? 'selected' : ''}>Tool</option>
                    <option value="soft_skill" ${getCategoryValue(recordElement) === 'soft_skill' ? 'selected' : ''}>Soft Skill</option>
                    <option value="language" ${getCategoryValue(recordElement) === 'language' ? 'selected' : ''}>Language</option>
                    <option value="other" ${getCategoryValue(recordElement) === 'other' ? 'selected' : ''}>Other</option>
                </select>
                <select name="proficiency">
                    <option value="1" ${getProficiencyValue(recordElement) === '1' ? 'selected' : ''}>Beginner</option>
                    <option value="2" ${getProficiencyValue(recordElement) === '2' ? 'selected' : ''}>Elementary</option>
                    <option value="3" ${getProficiencyValue(recordElement) === '3' ? 'selected' : ''}>Intermediate</option>
                    <option value="4" ${getProficiencyValue(recordElement) === '4' ? 'selected' : ''}>Advanced</option>
                    <option value="5" ${getProficiencyValue(recordElement) === '5' ? 'selected' : ''}>Expert</option>
                </select>
            `;
        }

        // Add submission buttons
        formHTML += `
            <div class="form-actions">
                <button type="button" class="cancel-btn" onclick="cancelEdit('${recordType}', ${recordId})">Cancel</button>
                <button type="button" class="save-btn" onclick="submitEdit('${recordType}', ${recordId})">Save Changes</button>
            </div>
        `;

        editForm.innerHTML = formHTML;

        // Hide the content and show the form
        const content = recordElement.innerHTML;
        recordElement.setAttribute('data-original-content', content);
        recordElement.innerHTML = '';
        recordElement.appendChild(editForm);
    }

    // Helper function to get text content from an element
    function getTextContent(container, selector) {
        const element = container.querySelector(selector);
        return element ? element.textContent.trim() : '';
    }

    // Helper function to get href from a link
    function getLinkHref(container, linkText) {
        const links = container.querySelectorAll('a');
        for (const link of links) {
            if (link.textContent.trim().includes(linkText)) {
                return link.getAttribute('href') || '';
            }
        }
        return '';
    }

    // Helper function to extract date from date range
    function extractDate(container, type) {
        const dateRangeElement = container.querySelector('.date-range');
        if (!dateRangeElement) return '';

        const dateRange = dateRangeElement.textContent.trim();
        const dates = dateRange.split('-').map(d => d.trim());

        if (type === 'start') {
            // Try to parse the start date
            if (dates[0]) {
                try {
                    const date = new Date(dates[0]);
                    return date.toISOString().substring(0, 10);
                } catch (e) {
                    return '';
                }
            }
        } else if (type === 'end' && dates[1] && dates[1] !== 'Present') {
            try {
                const date = new Date(dates[1]);
                return date.toISOString().substring(0, 10);
            } catch (e) {
                return '';
            }
        }

        return '';
    }

    // Helper function to check if position is current
    function isCurrentPosition(container) {
        const dateRangeElement = container.querySelector('.date-range');
        return dateRangeElement && dateRangeElement.textContent.includes('Present');
    }

    // Helper functions for skill category and proficiency
    function getCategoryValue(container) {
        const categoryElement = container.querySelector('.skill-category');
        return categoryElement ? categoryElement.getAttribute('data-category') : 'other';
    }

    function getProficiencyValue(container) {
        const proficiencyElement = container.querySelector('.skill-level');
        return proficiencyElement ? proficiencyElement.getAttribute('data-proficiency') : '3';
    }

    // Function to cancel editing
    function cancelEdit(recordType, recordId) {
        const itemContainer = document.querySelector(`[data-record-id="${recordId}"]`);
        if (!itemContainer) return;

        const originalContent = itemContainer.getAttribute('data-original-content');
        if (originalContent) {
            itemContainer.innerHTML = originalContent;
        }
    }

    // Function to submit edits
    function submitEdit(recordType, recordId) {
        const form = document.getElementById(`edit-${recordType}-${recordId}-form`);
        console.log("Form found:", form);
        if (!form) return;

        const formData = new FormData(form);
        console.log("FormData entries:", [...formData.entries()]);
        saveChanges(recordType, recordId, formData);
    }

    // Add function to handle editing records
    async function saveChanges(recordType, id, formData) {
        showLoading();
        try {
            // Add CSRF token to form data
            formData.append('csrfmiddlewaretoken', getCookie('csrftoken'));

            const csrftoken = getCookie('csrftoken');

            const response = await fetch(`/profile/edit/${recordType}/${id}/`, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': csrftoken
                }
            });

            const data = await response.json();

            if (data.success) {
                // Reload the page to show updated data
                location.reload();
            } else {
                alert('Error: ' + (data.error || 'Failed to save changes'));
            }
        } catch (error) {
            alert('Error saving changes: ' + error.message);
        } finally {
            hideLoading();
        }
    }

    // Function to update profile statistics
  function updateProfileStats() {
      fetch('/profile/stats/')
          .then(response => {
              if (!response.ok) {
                  throw new Error('Network response was not ok');
              }
              return response.json();
          })
          .then(data => {
              console.log('Profile stats data:', data);

              const workExperienceCount = document.getElementById('work-experience-count');
              if (workExperienceCount) {
                  workExperienceCount.textContent = data.experience_count;
              }

              const projectsCount = document.getElementById('projects-count');
              if (projectsCount) {
                  projectsCount.textContent = data.projects_count;
              }

              const skillsCount = document.getElementById('skills-count');
              if (skillsCount) {
                  skillsCount.textContent = data.skills_count;
              }

              const certificationsCount = document.getElementById('certifications-count');
              if (certificationsCount) {
                  certificationsCount.textContent = data.certifications_count;
              }

              const yearsOfExperience = document.getElementById('years-of-experience');
              if (yearsOfExperience) {
                  yearsOfExperience.textContent = data.years_experience;
              }
          })
          .catch(error => {
              console.error('Error fetching profile stats:', error);
              showNotification('error', 'Failed to update profile statistics');
          });
  }

    // Update stats when any form is submitted
    document.addEventListener('DOMContentLoaded', function() {
        const forms = document.querySelectorAll('form');
        forms.forEach(form => {
            form.addEventListener('submit', function() {
                // Wait a bit for the server to process the form
                setTimeout(updateProfileStats, 500);
            });
        });
    });

    // Update stats when any delete button is clicked
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('delete-btn')) {
            // Wait a bit for the server to process the deletion
            setTimeout(updateProfileStats, 500);
        }
    });

    // Initial stats update
    updateProfileStats();

    function validateWorkExperienceForm(form) {
        const startDate = form.querySelector('input[name="start_date"]');
        if (!startDate.value) {
            alert('Start date is required');
            startDate.focus();
            return false;
        }

        const endDate = form.querySelector('input[name="end_date"]');
        const current = form.querySelector('input[name="current"]');

        if (!current.checked && !endDate.value) {
            alert('Please either provide an end date or mark as current position');
            return false;
        }

        if (endDate.value && new Date(endDate.value) < new Date(startDate.value)) {
            alert('End date cannot be earlier than start date');
            return false;
        }

        return true;
    }

    // Function to show notifications to the user
    function showNotification(type, message) {
        // Create the notification element
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;

        // Add notification to the body
        document.body.appendChild(notification);

        // Make it visible
        setTimeout(() => {
            notification.classList.add('show');
        }, 10);

        // Remove it after 5 seconds
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 5000);
    }

    // Function to save profile basic information changes
    async function saveProfileChanges() {
        showLoading();
        try {
            const form = document.getElementById('profile-basic-form');
            const formData = new FormData(form);

            const csrftoken = getCookie('csrftoken');

            const response = await fetch("{% url 'core:edit_profile' %}", {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': csrftoken
                }
            });

            const data = await response.json();

            if (data.success) {
                showNotification('success', 'Profile updated successfully!');
                // No need to reload the page as we're just updating the profile
            } else {
                let errorMsg = 'Failed to update profile';
                if (data.errors) {
                    errorMsg = Object.entries(data.errors)
                        .map(([field, errors]) => `${field}: ${errors.join(', ')}`)
                        .join('\n');
                }
                showNotification('error', errorMsg);
            }
        } catch (error) {
            showNotification('error', 'Error updating profile: ' + error.message);
        } finally {
            hideLoading();
        }
    }
    document.addEventListener('DOMContentLoaded', function() {
      const generateBioButton = document.getElementById('generate-bio-btn');
      const professionalSummaryTextarea = document.getElementById('id_professional_summary');
      const bioStatusElement = document.getElementById('bio-status');
      // const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value; // Already have getCookie

      if (generateBioButton && professionalSummaryTextarea && bioStatusElement) {
          generateBioButton.addEventListener('click', function() {
              generateBioButton.disabled = true;
              generateBioButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
              bioStatusElement.textContent = 'Generating bio, please wait...';
              bioStatusElement.className = 'form-text text-info';

              fetch("{% url 'core:generate_profile_bio' %}", {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                      'X-CSRFToken': getCookie('csrftoken'),
                  }
              })
              .then(response => {
                  if (!response.ok) {
                      return response.json().then(err => { throw new Error(err.error || `Server error: ${response.status}`); })
                                       .catch(() => { throw new Error(`Server error: ${response.status}`); });
                  }
                  return response.json();
              })
              .then(data => {
                  if (data.success && data.bio) {
                      professionalSummaryTextarea.value = data.bio;
                      bioStatusElement.textContent = 'Bio generated successfully! Review and save your profile.';
                      bioStatusElement.className = 'form-text text-success';
                  } else {
                      bioStatusElement.textContent = 'Error: ' + (data.error || 'Failed to generate bio.');
                      bioStatusElement.className = 'form-text text-danger';
                  }
              })
              .catch(error => {
                  console.error('Error generating bio:', error);
                  bioStatusElement.textContent = 'Error: ' + error.message;
                  bioStatusElement.className = 'form-text text-danger';
              })
              .finally(() => {
                  generateBioButton.disabled = false;
                  generateBioButton.innerHTML = '<i class="fas fa-magic"></i> Generate Bio with AI';
              });
          });
      }
  });
</script>
{% endblock %}
